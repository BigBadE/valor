<!doctype html>
<meta charset="utf-8">
<title>MutationObserver attributes basic</title>
<div id="out"></div>
<script>
// Set up element and observer
const el = document.createElement('div');
let seen = [];
const obs = new MutationObserver((records) => {
  for (const r of records) {
    if (r && r.type === 'attributes') {
      const name = r.attributeName || '';
      const oldVal = (r.oldValue == null) ? '' : String(r.oldValue);
      seen.push('attr:' + name + ':' + oldVal);
    } else {
      seen.push(String(r && r.type));
    }
  }
});
obs.observe(el, { attributes: true, attributeOldValue: true, attributeFilter: ['data-x', 'class'] });

// Mutations
el.setAttribute('data-x', '1');      // oldValue ''
el.setAttribute('data-x', '2');      // oldValue '1'
el.setAttribute('class', 'a');       // captured

// Ensure delivery runs before we commit output. We schedule our own microtask after MO's.
queueMicrotask(() => {
  // Disconnect to avoid further records
  obs.disconnect();
  var out = document.getElementById('out');
  out.textContent = seen.join('|');
});
</script>
