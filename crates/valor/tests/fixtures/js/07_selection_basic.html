<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Selection Basic</title>
  <style>
    html, body { margin: 0; padding: 0; font-family: monospace; font-size: 16px; }
    #text { padding: 8px; }
  </style>
</head>
<body>
  <div id="text">Hello <b>World</b>!</div>
  <script>
    window._valorRun = function() {
      try {
        const text = document.getElementById('text');
        const sel = window.getSelection();
        sel.removeAllRanges();
        const range = document.createRange();
        // Select "lo World" across inline boundary
        const helloNode = text.firstChild; // "Hello "
        const boldNode = text.querySelector('b').firstChild; // "World"
        range.setStart(helloNode, 3);
        range.setEnd(boldNode, 2);
        sel.addRange(range);
        _valorAssert('selection has 1 range', sel.rangeCount === 1, 'count='+sel.rangeCount);
        _valorAssert('anchor at correct offset', sel.anchorOffset === 3, 'anchor='+sel.anchorOffset);
        _valorAssert('focus in bold node', sel.focusNode === boldNode, 'focusNode tag='+(sel.focusNode && sel.focusNode.parentElement && sel.focusNode.parentElement.tagName));
      } catch (e) {
        _valorAssert('selection-basic-exception', false, String(e && e.stack || e));
      }
    };
  </script>
</body>
</html>
