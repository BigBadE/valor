# CSS Display — Spec Coverage Map (CSS Display 3)

Primary spec: <https://www.w3.org/TR/css-display-3/>

## Scope and maturity

- Status: [Production] for box generation and display tree normalization; [MVP] for anonymous blocks and IFC.
- Non-production items:
  - [MVP] Anonymous block synthesis for inline runs.
  - [MVP] Inline formatting context (line boxes) and inline sizing from shaped text.
  - [TODO] Integration with block/inline formatting contexts across BFC boundaries.

## One-to-one spec mapping

- §2.1/§2.2 — Outer/Inner display types
  - Status: [MVP]
  - Spec: https://www.w3.org/TR/css-display-3/#outer-role, https://www.w3.org/TR/css-display-3/#inner-model
  - Code:
    - `css_display::chapter2::part_2_1_outer_inner::is_block_level_outer`
  - Notes: Run-in/table/grid/ruby are not modeled in the public `Display` yet.

- §2.5 — Box Generation (none/contents)
  - Status: [Production]
  - Spec: https://www.w3.org/TR/css-display-3/#box-generation
  - Code:
    - `css_display::chapter2::part_2_5_box_generation::normalize_children`
  - Notes: Integrates §3 tree-abiding ordering and a §4 visibility hook.

- §2.7 — Automatic Box Type Transformations
  - Status: [MVP]
  - Spec: https://www.w3.org/TR/css-display-3/#transformations
  - Code:
    - `css_display::chapter2::part_2_7_transformations::used_display_for_child`
  - Notes: Handles root, float/position blockification, and flex parent cases (grid/ruby/table deferred).

- §2.3 — Generating Marker Boxes (list-item)
  - Status: [TODO]
  - Spec: https://www.w3.org/TR/css-display-3/#list-items
  - Code:
    - `css_display::chapter2::part_2_3_list_items::maybe_list_item_child`
  - Notes: MVP seam only; returns false until style engine exposes `list-item` and marker/counter plumbing is available.

- §3 — Display Order and Tree-Abiding
  - Status: [MVP]
  - Spec: https://www.w3.org/TR/css-display-3/#order
  - Code:
    - `css_display::chapter3::tree_abiding_children`
  - Notes: MVP preserves DOM order; reordering is handled by layout models (flex/grid).

- §4 — Visibility
  - Status: [MVP]
  - Spec: https://www.w3.org/TR/css-display-3/#visibility
  - Code:
    - `css_display::chapter4::is_visible_for_layout`
  - Notes: Style engine does not yet expose a visibility property; helper is a paint-time seam (no-op for now).

- Inline Formatting Context (RFC; CSS 2.2 §9.4.2)
  - Status: [MVP]
  - Spec: https://www.w3.org/TR/CSS22/visuren.html#inline-formatting
  - Code:
    - `css_display::build_inline_context`, `css_display::inline_context::build_inline_context_with_filter`
    - `css_display::build_anonymous_block_runs`
  - Notes: Groups inline runs into line boxes; whitespace collapsing and shaping are deferred to text/layout modules.

## Algorithms and data flow

- Entry points (planned):
  - `display::normalize_children()` — perform display tree normalization (display: none/contents). Anonymous blocks to be added here.
  - `display::build_inline_context()` — produce line boxes and inline fragments.
- Integration:
  - Upstream: `style_engine::ComputedStyle`.
  - Downstream: `layouter` consumes normalized tree via `box_tree::flatten_display_children()` and inline fragments for layout passes.

## Edge cases and conformance nuances

- `display: contents` and anonymous block interactions with margin collapsing and BFC boundaries.
- Whitespace collapsing within inline formatting context (to be implemented here, not in layouter).

## Testing and fixtures

- Fixtures under: `crates/css/modules/display/tests/fixtures/layout/inline/**`.
- To ignore a fixture (expected failure), rename it with the `.fail` extension. The harness only runs `.html` fixtures; `.fail` files are skipped by discovery.

---

# Verbatim Spec (CSS Display Level 3)

Legal notice (required for embedded spec text):

```
Valor: https://github.com/BigBadE/Valor
Copyright © [2025] World Wide Web Consortium. All Rights Reserved. This work is distributed under the W3C® Software and Document License [1] in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
[1] https://www.w3.org/Consortium/Legal/copyright-software
```

Note: Each top-level section below MUST begin with a status marker and be followed by a mapping block. The embedded content is sourced directly from the W3C CSS Display Module Level 3 specification.

<!-- BEGIN VERBATIM SPEC: DO NOT EDIT BELOW. This block is auto-generated by scripts/vendor_display_spec.ps1 -->

<h2 class="heading settled" data-level="2" id="the-display-properties"><span class="secno">2. </span><span class="content"> Box Layout Modes: the <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display①⓪">display</a> property</span><a class="self-link" href="#the-display-properties"></a></h2>
<div data-valor-status="the-display-properties">
 <p><strong>Status:</strong> [MVP]</p>
 <p><strong>Code:</strong> <code>display::normalize_children</code>, <code>display::normalize_with_anonymous_runs</code>, <code>display::chapter2::part_2_7_transformations::used_display_for_child</code></p>
 <p><strong>Fixtures:</strong> <em>None</em></p>
</div>
   <table class="def propdef" data-link-for-hint="display">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-display">display</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">[ <a class="production css" data-link-type="type" href="#typedef-display-outside" id="ref-for-typedef-display-outside" title="Expands to: block | inline | run-in">&lt;display-outside></a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-any" id="ref-for-comb-any">||</a> <a class="production css" data-link-type="type" href="#typedef-display-inside" id="ref-for-typedef-display-inside" title="Expands to: flex | flow | flow-root | grid | ruby | table">&lt;display-inside></a> ] <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one">|</a> <a class="production css" data-link-type="type" href="#typedef-display-listitem" id="ref-for-typedef-display-listitem" title="Expands to: list-item">&lt;display-listitem></a> <span id="ref-for-comb-one①">|</span> <a class="production css" data-link-type="type" href="#typedef-display-internal" id="ref-for-typedef-display-internal" title="Expands to: ruby-base | ruby-base-container | ruby-text | ruby-text-container | table-caption | table-cell | table-column | table-column-group | table-footer-group | table-header-group | table-row | table-row-group">&lt;display-internal></a> <span id="ref-for-comb-one②">|</span> <a class="production css" data-link-type="type" href="#typedef-display-box" id="ref-for-typedef-display-box" title="Expands to: contents | none">&lt;display-box></a> <span id="ref-for-comb-one③">|</span> <a class="production css" data-link-type="type" href="#typedef-display-legacy" id="ref-for-typedef-display-legacy" title="Expands to: inline-block | inline-flex | inline-grid | inline-table">&lt;display-legacy></a> 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>inline 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a href="https://www.w3.org/TR/css-pseudo/#generated-content" title="Includes ::before and ::after pseudo-elements.">all elements</a> 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no 
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>a pair of keywords representing the <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type">inner</a> and <a data-link-type="dfn" href="#outer-display-type" id="ref-for-outer-display-type">outer</a> display types plus optional <a class="css" data-link-type="maybe" href="#valdef-display-list-item" id="ref-for-valdef-display-list-item">list-item</a> flag, or a <a class="production css" data-link-type="type" href="#typedef-display-internal" id="ref-for-typedef-display-internal①" title="Expands to: ruby-base | ruby-base-container | ruby-text | ruby-text-container | table-caption | table-cell | table-column | table-column-group | table-footer-group | table-header-group | table-row | table-row-group">&lt;display-internal></a> or <a class="production css" data-link-type="type" href="#typedef-display-box" id="ref-for-typedef-display-box①" title="Expands to: contents | none">&lt;display-box></a> keyword; see prose in a variety of specs for computation rules 
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar 
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>not animatable 
   </table>
   <p class="all-media">User agents are expected to support this property on all media, including non-visual ones.
	The <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display①①">display</a> property defines an element’s <dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="display-type">display type</dfn>,
	which consists of the two basic qualities of how an element generates boxes: </p>
   <ul>
    <li data-md>
     <p>the <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-local-lt="inner" id="inner-display-type">inner display type</dfn>,
which defines (if it is a <a data-link-type="dfn" href="#replaced-element" id="ref-for-replaced-element">non-replaced element</a>) the kind of <a data-link-type="dfn" href="#formatting-context" id="ref-for-formatting-context">formatting context</a> it generates,
dictating how its descendant boxes are laid out.
(The inner display of a <span id="ref-for-replaced-element①">replaced element</span> is outside the scope of CSS.)</p>
    <li data-md>
     <p>the <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-local-lt="outer" id="outer-display-type">outer display type</dfn>,
which dictates how the <a data-link-type="dfn" href="#principal-box" id="ref-for-principal-box⑥">principal box</a> itself participates in <a data-link-type="dfn" href="#flow-layout" id="ref-for-flow-layout">flow layout</a>.</p>
   </ul>
   <p><a data-link-type="dfn" href="#css-text-sequence" id="ref-for-css-text-sequence⑤">Text sequences</a> have no <a data-link-type="dfn" href="#display-type" id="ref-for-display-type①">display type</a>.</p>
   <p>Some <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display①②">display</a> values have additional side-effects:
	such as <a class="css" data-link-type="maybe" href="#valdef-display-list-item" id="ref-for-valdef-display-list-item①">list-item</a>, which also generates a <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-pseudo-4/#selectordef-marker" id="ref-for-selectordef-marker">::marker</a> pseudo-element,
	and <a class="css" data-link-type="maybe" href="#valdef-display-none" id="ref-for-valdef-display-none①">none</a>, which causes the element’s entire subtree to be left out of the box tree.</p>
   <div class="advisement"> The <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display①③">display</a> property has no effect on an element’s semantics:
		these are defined by the <a data-link-type="dfn" href="https://www.w3.org/TR/selectors-4/#document-language" id="ref-for-document-language">document language</a> and <em>are not affected by CSS</em>.
		Aside from the <a class="css" data-link-type="maybe" href="#valdef-display-none" id="ref-for-valdef-display-none②">none</a> value,
		which also affects the aural/speech output <a data-link-type="biblio" href="#biblio-css-speech-1" title="CSS Speech Module Level 1">[CSS-SPEECH-1]</a> and interactivity of an element and its descendants,
		the <span class="property" id="ref-for-propdef-display①④">display</span> property only affects visual layout:
		its purpose is to allow designers freedom
		to change the layout behavior of an element <em>without</em> affecting the underlying document semantics. </div>
   <p>Values are defined as follows:</p>
<pre class="prod"><dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-display-outside">&lt;display-outside></dfn>  = block <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one④">|</a> inline <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑤">|</a> run-in
<dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-display-inside">&lt;display-inside></dfn>   = flow <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑥">|</a> flow-root <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑦">|</a> table <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑧">|</a> flex <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one⑨">|</a> grid <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⓪">|</a> ruby
<dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-display-listitem">&lt;display-listitem></dfn> = <a class="production" data-link-type="type" href="#typedef-display-outside" id="ref-for-typedef-display-outside①" title="Expands to: block | inline | run-in">&lt;display-outside></a><a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-opt" id="ref-for-mult-opt">?</a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-all" id="ref-for-comb-all">&amp;&amp;</a> [ flow <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①①">|</a> flow-root ]<a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#mult-opt" id="ref-for-mult-opt①">?</a> <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-all" id="ref-for-comb-all①">&amp;&amp;</a> list-item
<dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-display-internal">&lt;display-internal></dfn> = table-row-group <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①②">|</a> table-header-group <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①③">|</a>
                     table-footer-group <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①④">|</a> table-row <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⑤">|</a> table-cell <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⑥">|</a>
                     table-column-group <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⑦">|</a> table-column <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⑧">|</a> table-caption <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one①⑨">|</a>
                     ruby-base <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②⓪">|</a> ruby-text <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②①">|</a> ruby-base-container <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②②">|</a>
                     ruby-text-container
<dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-display-box">&lt;display-box></dfn>      = contents <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②③">|</a> none
<dfn class="dfn-paneled" data-dfn-type="type" data-export id="typedef-display-legacy">&lt;display-legacy></dfn>   = inline-block <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②④">|</a> inline-table <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②⑤">|</a> inline-flex <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②⑥">|</a> inline-grid
</pre>
   <p>The following informative table summarizes the values of <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display①⑤">display</a>:</p>
   <table class="data" id="display-value-summary">
    <thead>
     <tr>
      <th>Short <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display①⑥">display</a> 
      <th>Full <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display①⑦">display</a> 
      <th>Generated box 
    <tbody title="Box Suppression Display Types">
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-none" id="ref-for-valdef-display-none③">none</a> 
      <td>— 
      <td>subtree omitted from <a data-link-type="dfn" href="#box-tree" id="ref-for-box-tree⑦">box tree</a> 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-contents" id="ref-for-valdef-display-contents①">contents</a> 
      <td>— 
      <td>element replaced by contents in <a data-link-type="dfn" href="#box-tree" id="ref-for-box-tree⑧">box tree</a> 
    <tbody title="Flow Layout Display Types">
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-block" id="ref-for-valdef-display-block">block</a> 
      <td><span class="css">block flow</span> 
      <td><a data-link-type="dfn" href="#block-level" id="ref-for-block-level">block-level</a> <a data-link-type="dfn" href="#block-container" id="ref-for-block-container">block container</a> <abbr title="also known as">aka</abbr> <a data-link-type="dfn" href="#block-box" id="ref-for-block-box①">block box</a> 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-flow-root" id="ref-for-valdef-display-flow-root">flow-root</a> 
      <td><span class="css">block flow-root</span> 
      <td><a data-link-type="dfn" href="#block-level" id="ref-for-block-level①">block-level</a> <a data-link-type="dfn" href="#block-container" id="ref-for-block-container①">block container</a> that establishes a new <a data-link-type="dfn" href="#block-formatting-context" id="ref-for-block-formatting-context">block formatting context</a> (<a data-link-type="dfn" href="#bfc" id="ref-for-bfc">BFC</a>) 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-inline" id="ref-for-valdef-display-inline">inline</a> 
      <td><span class="css">inline flow</span> 
      <td><a data-link-type="dfn" href="#inline-box" id="ref-for-inline-box①">inline box</a> 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-inline-block" id="ref-for-valdef-display-inline-block">inline-block</a> 
      <td><span class="css">inline flow-root</span> 
      <td><a data-link-type="dfn" href="#inline-level" id="ref-for-inline-level">inline-level</a> <a data-link-type="dfn" href="#block-container" id="ref-for-block-container②">block container</a> <abbr title="also known as">aka</abbr> <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="inline block | inline block box" id="inline-block">inline block</dfn> 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-run-in" id="ref-for-valdef-display-run-in①">run-in</a> 
      <td><span class="css">run-in flow</span> 
      <td><a data-link-type="dfn" href="#run-in" id="ref-for-run-in">run-in box</a> (<a data-link-type="dfn" href="#inline-box" id="ref-for-inline-box②">inline box</a> with special box-tree-munging rules) 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-list-item" id="ref-for-valdef-display-list-item②">list-item</a> 
      <td><span class="css">block flow list-item</span> 
      <td><a data-link-type="dfn" href="#block-box" id="ref-for-block-box②">block box</a> with additional <a href="https://www.w3.org/TR/CSS2/generate.html#lists">marker box</a> 
     <tr>
      <td><span class="css">inline list-item</span> 
      <td><span class="css">inline flow list-item</span> 
      <td><a data-link-type="dfn" href="#inline-box" id="ref-for-inline-box③">inline box</a> with additional <a href="https://www.w3.org/TR/CSS2/generate.html#lists">marker box</a> 
    <tbody title="Formatting Context Root Display Types">
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-flex" id="ref-for-valdef-display-flex">flex</a> 
      <td><span class="css">block flex</span> 
      <td><a data-link-type="dfn" href="#block-level" id="ref-for-block-level②">block-level</a> <a data-link-type="dfn" href="https://www.w3.org/TR/css-flexbox-1/#flex-container" id="ref-for-flex-container">flex container</a> 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-inline-flex" id="ref-for-valdef-display-inline-flex">inline-flex</a> 
      <td><span class="css">inline flex</span> 
      <td><a data-link-type="dfn" href="#inline-level" id="ref-for-inline-level①">inline-level</a> <a data-link-type="dfn" href="https://www.w3.org/TR/css-flexbox-1/#flex-container" id="ref-for-flex-container①">flex container</a> 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-grid" id="ref-for-valdef-display-grid">grid</a> 
      <td><span class="css">block grid</span> 
      <td><a data-link-type="dfn" href="#block-level" id="ref-for-block-level③">block-level</a> <a data-link-type="dfn" href="https://www.w3.org/TR/css-grid-2/#grid-container" id="ref-for-grid-container">grid container</a> 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-inline-grid" id="ref-for-valdef-display-inline-grid">inline-grid</a> 
      <td><span class="css">inline grid</span> 
      <td><a data-link-type="dfn" href="#inline-level" id="ref-for-inline-level②">inline-level</a> <a data-link-type="dfn" href="https://www.w3.org/TR/css-grid-2/#grid-container" id="ref-for-grid-container①">grid container</a> 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-ruby" id="ref-for-valdef-display-ruby">ruby</a> 
      <td><span class="css">inline ruby</span> 
      <td><a data-link-type="dfn" href="#inline-level" id="ref-for-inline-level③">inline-level</a> <a data-link-type="dfn" href="https://www.w3.org/TR/css-ruby-1/#ruby-container" id="ref-for-ruby-container">ruby container</a> 
     <tr>
      <td><span class="css">block ruby</span> 
      <td><span class="css">block ruby</span> 
      <td><a data-link-type="dfn" href="#block-box" id="ref-for-block-box③">block box</a> containing <a data-link-type="dfn" href="https://www.w3.org/TR/css-ruby-1/#ruby-container" id="ref-for-ruby-container①">ruby container</a> 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-table" id="ref-for-valdef-display-table">table</a> 
      <td><span class="css">block table</span> 
      <td><a data-link-type="dfn" href="#block-level" id="ref-for-block-level④">block-level</a> <a data-link-type="dfn" href="https://www.w3.org/TR/css-tables-3/#table-wrapper-box" id="ref-for-table-wrapper-box①">table wrapper box</a> containing <a data-link-type="dfn" href="https://www.w3.org/TR/css-tables-3/#table-grid-box" id="ref-for-table-grid-box①">table grid box</a> 
     <tr>
      <td><a class="css" data-link-type="maybe" href="#valdef-display-inline-table" id="ref-for-valdef-display-inline-table">inline-table</a> 
      <td><span class="css">inline table</span> 
      <td><a data-link-type="dfn" href="#inline-level" id="ref-for-inline-level④">inline-level</a> <a data-link-type="dfn" href="https://www.w3.org/TR/css-tables-3/#table-wrapper-box" id="ref-for-table-wrapper-box②">table wrapper box</a> containing <a data-link-type="dfn" href="https://www.w3.org/TR/css-tables-3/#table-grid-box" id="ref-for-table-grid-box②">table grid box</a> 
    <tbody title="Layout-internal display types">
     <tr>
      <td><a class="production css" data-link-type="type" href="#typedef-display-internal" id="ref-for-typedef-display-internal②" title="Expands to: ruby-base | ruby-base-container | ruby-text | ruby-text-container | table-caption | table-cell | table-column | table-column-group | table-footer-group | table-header-group | table-row | table-row-group">&lt;display-internal></a> types 
      <td>— 
      <td><a href="#layout-specific-display">layout-specific internal box</a> 
   </table>
   <p class="note" role="note"><span class="marker">Note:</span> Following the precedence rules of “most backwards-compatible, then shortest”,
	serialization of equivalent <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display①⑧">display</a> values uses the “Short <span class="property" id="ref-for-propdef-display①⑨">display</span>” column. <a data-link-type="biblio" href="#biblio-cssom" title="CSS Object Model (CSSOM)">[CSSOM]</a></p>
   <h3 class="heading settled" data-level="2.1" id="outer-role"><span class="secno">2.1. </span><span class="content"> Outer Display Roles for Flow Layout: the <a class="css" data-link-type="maybe" href="#valdef-display-block" id="ref-for-valdef-display-block①">block</a>, <a class="css" data-link-type="maybe" href="#valdef-display-inline" id="ref-for-valdef-display-inline①">inline</a>, and <a class="css" data-link-type="maybe" href="#valdef-display-run-in" id="ref-for-valdef-display-run-in②">run-in</a> keywords</span><a class="self-link" href="#outer-role"></a></h3>
<div data-valor-status="outer-role">
 <p><strong>Status:</strong> [MVP]</p>
 <p><strong>Code:</strong> <code>display::chapter2::part_2_1_outer_inner::is_block_level_outer</code></p>
 <p><strong>Fixtures:</strong> <em>None</em></p>
</div>
   <p>The <a class="production css" data-link-type="type" href="#typedef-display-outside" id="ref-for-typedef-display-outside②" title="Expands to: block | inline | run-in">&lt;display-outside></a> keywords specify the element’s <a data-link-type="dfn" href="#outer-display-type" id="ref-for-outer-display-type①">outer display type</a>,
	which is essentially its <a data-link-type="dfn" href="#principal-box" id="ref-for-principal-box⑦">principal box’s</a> role in <a data-link-type="dfn" href="#flow-layout" id="ref-for-flow-layout①">flow layout</a>.
	They are defined as follows:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-outside>" data-dfn-type="value" data-export id="valdef-display-block">block</dfn> 
    <dd> The element generates a box that is <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export data-lt="block-level box" id="block-level-box">block-level</dfn> when placed in <a data-link-type="dfn" href="#flow-layout" id="ref-for-flow-layout②">flow layout</a>. <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-outside>" data-dfn-type="value" data-export id="valdef-display-inline">inline</dfn> 
    <dd> The element generates a box that is <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export data-lt="inline-level box" id="inline-level-box">inline-level</dfn> when placed in <a data-link-type="dfn" href="#flow-layout" id="ref-for-flow-layout③">flow layout</a>. <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-outside>" data-dfn-type="value" data-export id="valdef-display-run-in">run-in</dfn> 
    <dd> The element generates an <a data-link-type="dfn" href="#run-in" id="ref-for-run-in①">run-in box</a>,
			which is a type of <a data-link-type="dfn" href="#inline-level-box" id="ref-for-inline-level-box">inline-level box</a> with special behavior that attempts to merge it into a subsequent block container.
			See <a href="#run-in-layout">§ 5 Run-In Layout</a> for details. 
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> <a data-link-type="dfn" href="#outer-display-type" id="ref-for-outer-display-type②">Outer display types</a> do affect <a data-link-type="dfn" href="#replaced-element" id="ref-for-replaced-element②">replaced elements</a>.</p>
   <p>If a <a class="production css" data-link-type="type" href="#typedef-display-outside" id="ref-for-typedef-display-outside③" title="Expands to: block | inline | run-in">&lt;display-outside></a> value is specified but <a class="production css" data-link-type="type" href="#typedef-display-inside" id="ref-for-typedef-display-inside①" title="Expands to: flex | flow | flow-root | grid | ruby | table">&lt;display-inside></a> is omitted,
	the element’s <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type①">inner display type</a> defaults to <a class="css" data-link-type="maybe" href="#valdef-display-flow" id="ref-for-valdef-display-flow">flow</a>.</p>
   <h3 class="heading settled" data-level="2.2" id="inner-model"><span class="secno">2.2. </span><span class="content"> Inner Display Layout Models: the <a class="css" data-link-type="maybe" href="#valdef-display-flow" id="ref-for-valdef-display-flow①">flow</a>, <a class="css" data-link-type="maybe" href="#valdef-display-flow-root" id="ref-for-valdef-display-flow-root①">flow-root</a>, <a class="css" data-link-type="maybe" href="#valdef-display-table" id="ref-for-valdef-display-table①">table</a>, <a class="css" data-link-type="maybe" href="#valdef-display-flex" id="ref-for-valdef-display-flex①">flex</a>, <a class="css" data-link-type="maybe" href="#valdef-display-grid" id="ref-for-valdef-display-grid①">grid</a>, and <a class="css" data-link-type="maybe" href="#valdef-display-ruby" id="ref-for-valdef-display-ruby①">ruby</a> keywords</span><a class="self-link" href="#inner-model"></a></h3>
<div data-valor-status="inner-model">
 <p><strong>Status:</strong> [MVP]</p>
 <p><strong>Code:</strong> <code>display::chapter2::part_2_1_outer_inner::is_block_level_outer</code></p>
 <p><strong>Fixtures:</strong> <em>None</em></p>
</div>
   <p>The <a class="production css" data-link-type="type" href="#typedef-display-inside" id="ref-for-typedef-display-inside②" title="Expands to: flex | flow | flow-root | grid | ruby | table">&lt;display-inside></a> keywords specify the element’s <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type②">inner display type</a>,
	which defines the type of formatting context that lays out its contents
	(assuming it is a <a data-link-type="dfn" href="#replaced-element" id="ref-for-replaced-element③">non-replaced element</a>).
	They are defined as follows:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-inside>" data-dfn-type="value" data-export id="valdef-display-flow">flow</dfn> 
    <dd>
      The element lays out its contents using <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export id="flow-layout">flow layout</dfn> (<a href="https://www.w3.org/TR/CSS2/visuren.html">block-and-inline layout</a>). 
     <p>If its <a data-link-type="dfn" href="#outer-display-type" id="ref-for-outer-display-type③">outer display type</a> is <a class="css" data-link-type="maybe" href="#valdef-display-inline" id="ref-for-valdef-display-inline②">inline</a> or <a class="css" data-link-type="maybe" href="#valdef-display-run-in" id="ref-for-valdef-display-run-in③">run-in</a>,
			and it is participating in a <a data-link-type="dfn" href="#block-formatting-context" id="ref-for-block-formatting-context①">block</a> or <a data-link-type="dfn" href="#inline-formatting-context" id="ref-for-inline-formatting-context">inline</a> formatting context,
			then it generates an <a data-link-type="dfn" href="#inline-box" id="ref-for-inline-box④">inline box</a>.</p>
     <p>Otherwise it generates a <a data-link-type="dfn" href="#block-container" id="ref-for-block-container③">block container</a> box.</p>
     <p>Depending on the value of other properties (such as <a class="property css" data-link-type="property" href="https://www.w3.org/TR/css-position-3/#propdef-position" id="ref-for-propdef-position">position</a>, <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-float" id="ref-for-propdef-float">float</a>, or <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-overflow" id="ref-for-propdef-overflow">overflow</a>)
			and whether it is itself participating in a block or inline <a data-link-type="dfn" href="#formatting-context" id="ref-for-formatting-context①">formatting context</a>,
			it either establishes a new <a data-link-type="dfn" href="#block-formatting-context" id="ref-for-block-formatting-context②">block formatting context</a> for its contents
			or integrates its contents into its parent <span id="ref-for-formatting-context②">formatting context</span>.
			See <a href="https://www.w3.org/TR/CSS2/visuren.html">CSS2.1 Chapter 9</a>. <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> A <a data-link-type="dfn" href="#block-container" id="ref-for-block-container④">block container</a> that establishes a new <span id="ref-for-block-formatting-context③">block formatting context</span> is considered to have a used <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type③">inner display type</a> of <a class="css" data-link-type="maybe" href="#valdef-display-flow-root" id="ref-for-valdef-display-flow-root②">flow-root</a>.</p>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-inside>" data-dfn-type="value" data-export id="valdef-display-flow-root">flow-root</dfn> 
    <dd> The element generates a <a data-link-type="dfn" href="#block-container" id="ref-for-block-container⑤">block container</a> box,
			and lays out its contents using <a data-link-type="dfn" href="#flow-layout" id="ref-for-flow-layout④">flow layout</a>.
			It always establishes a new <a data-link-type="dfn" href="#block-formatting-context" id="ref-for-block-formatting-context④">block formatting context</a> for its contents. <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-inside>" data-dfn-type="value" data-export id="valdef-display-table">table</dfn> 
    <dd> The element generates a principal <a data-link-type="dfn" href="https://www.w3.org/TR/css-tables-3/#table-wrapper-box" id="ref-for-table-wrapper-box③">table wrapper box</a> that establishes a <a data-link-type="dfn" href="#block-formatting-context" id="ref-for-block-formatting-context⑤">block formatting context</a>,
			and which contains
			an additionally-generated <a data-link-type="dfn" href="https://www.w3.org/TR/css-tables-3/#table-grid-box" id="ref-for-table-grid-box③">table grid box</a> that establishes a <a data-link-type="dfn">table formatting context</a>. <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-inside>" data-dfn-type="value" data-export id="valdef-display-flex">flex</dfn> 
    <dd> The element generates a principal <a data-link-type="dfn" href="https://www.w3.org/TR/css-flexbox-1/#flex-container" id="ref-for-flex-container②">flex container</a> box
			and establishes a <a data-link-type="dfn" href="https://www.w3.org/TR/css-flexbox-1/#flex-formatting-context" id="ref-for-flex-formatting-context">flex formatting context</a>. <a data-link-type="biblio" href="#biblio-css-flexbox-1" title="CSS Flexible Box Layout Module Level 1">[CSS-FLEXBOX-1]</a> 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-inside>" data-dfn-type="value" data-export id="valdef-display-grid">grid</dfn> 
    <dd>
      The element generates a principal <a data-link-type="dfn" href="https://www.w3.org/TR/css-grid-2/#grid-container" id="ref-for-grid-container②">grid container</a> box,
			and establishes a <a data-link-type="dfn" href="https://www.w3.org/TR/css-grid-2/#grid-formatting-context" id="ref-for-grid-formatting-context">grid formatting context</a>. <a data-link-type="biblio" href="#biblio-css-grid-1" title="CSS Grid Layout Module Level 1">[CSS-GRID-1]</a> 
     <p>(Grids using <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-grid-2/#valdef-grid-template-rows-subgrid" id="ref-for-valdef-grid-template-rows-subgrid">subgrid</a> might not generate a new <a data-link-type="dfn" href="https://www.w3.org/TR/css-grid-2/#grid-formatting-context" id="ref-for-grid-formatting-context①">grid formatting context</a>;
			see <a data-link-type="biblio" href="#biblio-css-grid-2" title="CSS Grid Layout Module Level 2">[CSS-GRID-2]</a> for details.)</p>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-inside>" data-dfn-type="value" data-export id="valdef-display-ruby">ruby</dfn> 
    <dd> The element generates a <a data-link-type="dfn" href="https://www.w3.org/TR/css-ruby-1/#ruby-container" id="ref-for-ruby-container②">ruby container</a> box
			and establishes a <a data-link-type="dfn" href="https://www.w3.org/TR/css-ruby-1/#ruby-formatting-context" id="ref-for-ruby-formatting-context">ruby formatting context</a> in addition to integrating its base-level contents
			into its parent <a data-link-type="dfn" href="#formatting-context" id="ref-for-formatting-context③">formatting context</a> (if it is inline)
			or generating a wrapper box of the appropriate <a data-link-type="dfn" href="#outer-display-type" id="ref-for-outer-display-type④">outer display type</a> (if it is not). <a data-link-type="biblio" href="#biblio-css-ruby-1" title="CSS Ruby Annotation Layout Module Level 1">[CSS-RUBY-1]</a> 
   </dl>
   <p>If a <a class="production css" data-link-type="type" href="#typedef-display-inside" id="ref-for-typedef-display-inside③" title="Expands to: flex | flow | flow-root | grid | ruby | table">&lt;display-inside></a> value is specified but <a class="production css" data-link-type="type" href="#typedef-display-outside" id="ref-for-typedef-display-outside④" title="Expands to: block | inline | run-in">&lt;display-outside></a> is omitted,
	the element’s <a data-link-type="dfn" href="#outer-display-type" id="ref-for-outer-display-type⑤">outer display type</a> defaults to <a class="css" data-link-type="maybe" href="#valdef-display-block" id="ref-for-valdef-display-block②">block</a>—<wbr>except for <a class="css" data-link-type="maybe" href="#valdef-display-ruby" id="ref-for-valdef-display-ruby②">ruby</a>, which defaults to <a class="css" data-link-type="maybe" href="#valdef-display-inline" id="ref-for-valdef-display-inline③">inline</a>.</p>
   <h3 class="heading settled" data-level="2.3" id="list-items"><span class="secno">2.3. </span><span class="content"> Generating Marker Boxes: the <a class="css" data-link-type="maybe" href="#valdef-display-list-item" id="ref-for-valdef-display-list-item③">list-item</a> keyword</span><a class="self-link" href="#list-items"></a></h3>
<div data-valor-status="list-items">
 <p><strong>Status:</strong> [TODO]</p>
 <p><strong>Code:</strong> <em>Unimplemented</em></p>
 <p><strong>Fixtures:</strong> <em>None</em></p>
</div>
   <p>The <dfn class="dfn-paneled css" data-dfn-for="display, <display-listitem>" data-dfn-type="value" data-export id="valdef-display-list-item">list-item</dfn> keyword
	causes the element to generate a <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-pseudo-4/#selectordef-marker" id="ref-for-selectordef-marker①">::marker</a> pseudo-element <a data-link-type="biblio" href="#biblio-css-pseudo-4" title="CSS Pseudo-Elements Module Level 4">[CSS-PSEUDO-4]</a> with the content specified by its <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css2/#propdef-list-style" id="ref-for-propdef-list-style">list-style</a> properties
	(<a href="https://www.w3.org/TR/CSS2/generate.html#lists">CSS 2.1§12.5 Lists</a>) <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> together with a principal box of the specified type for its own contents.</p>
   <p>If no <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type④">inner display type</a> value is specified,
	the principal box’s <span id="ref-for-inner-display-type⑤">inner display type</span> defaults to <a class="css" data-link-type="maybe" href="#valdef-display-flow" id="ref-for-valdef-display-flow②">flow</a>.
	If no <a data-link-type="dfn" href="#outer-display-type" id="ref-for-outer-display-type⑥">outer display type</a> value is specified,
	the principal box’s <span id="ref-for-outer-display-type⑦">outer display type</span> defaults to <a class="css" data-link-type="maybe" href="#valdef-display-block" id="ref-for-valdef-display-block③">block</a>.</p>
   <p class="note" role="note"><span class="marker">Note:</span> In this level, as restricted in the grammar,
	list-items are limited to the <a data-link-type="dfn" href="#flow-layout" id="ref-for-flow-layout⑤">Flow Layout</a> display types
	(<a class="css" data-link-type="maybe" href="#valdef-display-block" id="ref-for-valdef-display-block④">block</a>/<a class="css" data-link-type="maybe" href="#valdef-display-inline" id="ref-for-valdef-display-inline④">inline</a>/<a class="css" data-link-type="maybe" href="#valdef-display-run-in" id="ref-for-valdef-display-run-in④">run-in</a> with <a class="css" data-link-type="maybe" href="#valdef-display-flow" id="ref-for-valdef-display-flow③">flow</a>/<a class="css" data-link-type="maybe" href="#valdef-display-flow-root" id="ref-for-valdef-display-flow-root③">flow-root</a> inner types).
	This restriction may be relaxed in a future level of this module.</p>
   <h3 class="heading settled" data-level="2.4" id="layout-specific-display"><span class="secno">2.4. </span><span class="content"> Layout-Internal Display Types: the <span class="css">table-*</span> and <span class="css">ruby-*</span> keywords</span><a class="self-link" href="#layout-specific-display"></a></h3>
<div data-valor-status="layout-specific-display">
 <p><strong>Status:</strong> [TODO]</p>
 <p><strong>Code:</strong> <em>Unimplemented</em></p>
 <p><strong>Fixtures:</strong> <em>None</em></p>
</div>
   <p>Some layout models, such as <a class="css" data-link-type="maybe" href="#valdef-display-table" id="ref-for-valdef-display-table②">table</a> and <a class="css" data-link-type="maybe" href="#valdef-display-ruby" id="ref-for-valdef-display-ruby③">ruby</a>,
	have a complex internal structure,
	with several different roles that their children and descendants can fill.
	This section defines those “<dfn class="dfn-paneled" data-dfn-type="dfn" data-export id="layout-internal">layout-internal</dfn>” <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display②⓪">display</a> values,
	which only have meaning within that particular layout mode.</p>
   <p>Unless otherwise specified,
	both the <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type⑥">inner display type</a> and the <a data-link-type="dfn" href="#outer-display-type" id="ref-for-outer-display-type⑧">outer display type</a> of elements using these <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display②①">display</a> values
	are set to the given keyword.</p>
   <p>When the <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display②②">display</a> property of a <a data-link-type="dfn" href="#replaced-element" id="ref-for-replaced-element④">replaced element</a> computes to
	one of the <a data-link-type="dfn" href="#layout-internal" id="ref-for-layout-internal">layout-internal</a> values,
	it is handled as having a used value of <a class="css" data-link-type="maybe" href="#valdef-display-inline" id="ref-for-valdef-display-inline⑤">inline</a>.
	White space collapsing and anonymous box generation must happen around those replaced elements
	based on that <span class="css" id="ref-for-valdef-display-inline⑥">inline</span> value,
	as if they never had a <span id="ref-for-layout-internal①">layout-internal</span> display value applied to them.</p>
   <p><strong class="advisement"> Authors should not assign a <a data-link-type="dfn" href="#layout-internal" id="ref-for-layout-internal②">layout-internal</a> display value to <a data-link-type="dfn" href="#replaced-element" id="ref-for-replaced-element⑤">replaced elements</a>.</strong></p>
   <p>The <a class="production css" data-link-type="type" href="#typedef-display-internal" id="ref-for-typedef-display-internal③" title="Expands to: ruby-base | ruby-base-container | ruby-text | ruby-text-container | table-caption | table-cell | table-column | table-column-group | table-footer-group | table-header-group | table-row | table-row-group">&lt;display-internal></a> keywords are defined as follows:</p>
   <dl>
    <dt><dfn class="css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-table-row-group">table-row-group<a class="self-link" href="#valdef-display-table-row-group"></a></dfn>, <dfn class="css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-table-header-group">table-header-group<a class="self-link" href="#valdef-display-table-header-group"></a></dfn>, <dfn class="css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-table-footer-group">table-footer-group<a class="self-link" href="#valdef-display-table-footer-group"></a></dfn>, <dfn class="dfn-paneled css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-table-row">table-row</dfn>, <dfn class="dfn-paneled css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-table-cell">table-cell</dfn>, <dfn class="css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-table-column-group">table-column-group<a class="self-link" href="#valdef-display-table-column-group"></a></dfn>, <dfn class="css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-table-column">table-column<a class="self-link" href="#valdef-display-table-column"></a></dfn> 
    <dd>
      The element is an <dfn class="dfn-paneled" data-dfn-for data-dfn-type="dfn" data-export id="internal-table-element">internal table element</dfn>.
			It generates the appropriate <dfn data-dfn-for data-dfn-type="dfn" data-export id="internal-table-box">internal table box<a class="self-link" href="#internal-table-box"></a></dfn> which participates in a <a data-link-type="dfn">table formatting context</a>.
			See <a href="https://www.w3.org/TR/CSS2/tables.html#table-display">CSS2§17.2</a> <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a>. 
     <p><a class="css" data-link-type="maybe" href="#valdef-display-table-cell" id="ref-for-valdef-display-table-cell">table-cell</a> boxes have a <a class="css" data-link-type="maybe" href="#valdef-display-flow-root" id="ref-for-valdef-display-flow-root④">flow-root</a> <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type⑦">inner display type</a>.</p>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-table-caption">table-caption</dfn> 
    <dd>
      The element generates a <dfn data-dfn-for data-dfn-type="dfn" data-export id="table-caption-box">table caption box<a class="self-link" href="#table-caption-box"></a></dfn>,
			which is a <a data-link-type="dfn" href="#block-box" id="ref-for-block-box④">block box</a> with special behavior with respect to table and table wrapper boxes.
			See <a href="https://www.w3.org/TR/CSS2/tables.html#table-display">CSS2§17.2</a> <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a>. 
     <p><a class="css" data-link-type="maybe" href="#valdef-display-table-caption" id="ref-for-valdef-display-table-caption">table-caption</a> boxes have a <a class="css" data-link-type="maybe" href="#valdef-display-flow-root" id="ref-for-valdef-display-flow-root⑤">flow-root</a> <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type⑧">inner display type</a>.</p>
    <dt>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-ruby-base">ruby-base</dfn>, <dfn class="dfn-paneled css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-ruby-text">ruby-text</dfn>, <dfn class="css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-ruby-base-container">ruby-base-container<a class="self-link" href="#valdef-display-ruby-base-container"></a></dfn>, <dfn class="css" data-dfn-for="display, <display-internal>" data-dfn-type="value" data-export id="valdef-display-ruby-text-container">ruby-text-container<a class="self-link" href="#valdef-display-ruby-text-container"></a></dfn> 
    <dd>
      The element is an <dfn data-dfn-for data-dfn-type="dfn" data-export id="internal-ruby-element">internal ruby element<a class="self-link" href="#internal-ruby-element"></a></dfn>.
			It generates the appropriate <dfn data-dfn-for data-dfn-type="dfn" data-export id="internal-ruby-box">internal ruby box<a class="self-link" href="#internal-ruby-box"></a></dfn> which participates in a <a data-link-type="dfn" href="https://www.w3.org/TR/css-ruby-1/#ruby-formatting-context" id="ref-for-ruby-formatting-context①">ruby formatting context</a>. <a data-link-type="biblio" href="#biblio-css-ruby-1" title="CSS Ruby Annotation Layout Module Level 1">[CSS-RUBY-1]</a> 
     <p><a class="css" data-link-type="maybe" href="#valdef-display-ruby-base" id="ref-for-valdef-display-ruby-base">ruby-base</a> and <a class="css" data-link-type="maybe" href="#valdef-display-ruby-text" id="ref-for-valdef-display-ruby-text">ruby-text</a> have a <a class="css" data-link-type="maybe" href="#valdef-display-flow" id="ref-for-valdef-display-flow④">flow</a> <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type⑨">inner display type</a>.</p>
   </dl>
   <p>Boxes with layout-specific display types generate anonymous wrapper boxes around themselves
	when placed in an incompatible parent,
	as defined by their respective specifications.</p>
   <div class="example" id="example-d11b97c3">
    <a class="self-link" href="#example-d11b97c3"></a> For example, Table Layout requires that a <a class="css" data-link-type="maybe" href="#valdef-display-table-cell" id="ref-for-valdef-display-table-cell①">table-cell</a> box
		must have a <a class="css" data-link-type="maybe" href="#valdef-display-table-row" id="ref-for-valdef-display-table-row">table-row</a> parent box. 
    <p>If it is misparented, like so:</p>
<pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>div</c-> <c- e>style</c-><c- o>=</c-><c- s>"display:block;"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>style</c-><c- o>=</c-><c- s>"display:table-cell"</c-><c- p>></c->...<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
    <p>It will generate wrapper boxes around itself,
		producing a structure like:</p>
<pre>block box
└anonymous table box
 └anonymous table-row-group box
  └anonymous table-row box
   └table-cell box
</pre>
    <p>Even if the parent is another <a data-link-type="dfn" href="#internal-table-element" id="ref-for-internal-table-element">internal table element</a>,
		if it’s not the <em>correct</em> one,
		wrapper boxes will be generated.
		For example, in the following markup:</p>
<pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>div</c-> <c- e>style</c-><c- o>=</c-><c- s>"display:table;"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>div</c-> <c- e>style</c-><c- o>=</c-><c- s>"display:table-row"</c-><c- p>></c->
    <c- p>&lt;</c-><c- f>div</c-> <c- e>style</c-><c- o>=</c-><c- s>"display:table-cell"</c-><c- p>></c->...<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
  <c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>div</c-><c- p>></c->
</pre>
    <p>Anonymous wrapper box generation will produce:</p>
<pre>table box
└anonymous table-row-group box
 └table-row box
  └table-cell box
</pre>
    <p>This "fix-up" ensures that table layout has a predictable structure to operate on.</p>
   </div>
   <h3 class="heading settled" data-level="2.5" id="box-generation"><span class="secno">2.5. </span><span class="content"> Box Generation: the <a class="css" data-link-type="maybe" href="#valdef-display-none" id="ref-for-valdef-display-none④">none</a> and <a class="css" data-link-type="maybe" href="#valdef-display-contents" id="ref-for-valdef-display-contents②">contents</a> keywords</span><a class="self-link" href="#box-generation"></a></h3>
   <div data-valor-status="box-generation">
    <p><strong>Status:</strong> [Production]</p>
    <p><strong>Code:</strong> <code>display::chapter2::part_2_5_box_generation::normalize_children</code></p>
    <p><strong>Fixtures:</strong>
      <code>crates/css/modules/display/tests/fixtures/layout/basics/05_overflow_clip.html</code>,
      <code>crates/css/modules/display/tests/fixtures/layout/clip/01_overflow_hidden.html</code>
    </p>
   </div>
   <p>While <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display②③">display</a> can control the <em>types</em> of boxes an element will generate,
	it can also control whether an element will generate any boxes at all.</p>
   <p>The <a class="production css" data-link-type="type" href="#typedef-display-box" id="ref-for-typedef-display-box②" title="Expands to: contents | none">&lt;display-box></a> keywords are defined as follows:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-box>" data-dfn-type="value" data-export id="valdef-display-contents">contents</dfn> 
    <dd>
      The element itself does not generate any boxes,
			but its children and pseudo-elements still generate <a data-link-type="dfn" href="#box" id="ref-for-box⑨">boxes</a> and <a data-link-type="dfn" href="#css-text-sequence" id="ref-for-css-text-sequence⑥">text sequences</a> as normal.
			For the purposes of box generation and layout,
			the element must be treated as if it had been replaced in the <a data-link-type="dfn" href="#element-tree" id="ref-for-element-tree①">element tree</a> by its contents
			(including both its source-document children and its pseudo-elements,
			such as <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-pseudo-4/#selectordef-before" id="ref-for-selectordef-before">::before</a> and <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-pseudo-4/#selectordef-after" id="ref-for-selectordef-after">::after</a> pseudo-elements,
			which are generated before/after the element’s children as normal). 
     <p class="note" role="note"><span class="marker">Note:</span> As only the box tree is affected,
			any semantics based on the document tree,
			such as selector-matching, event handling,
			and property <a data-link-type="dfn" href="https://www.w3.org/TR/css-cascade-5/#inheritance" id="ref-for-inheritance">inheritance</a>,
			are not affected. <strong>As of writing, however, <a href="https://github.com/w3c/csswg-drafts/issues/3040">this is not implemented correctly in major browsers</a>,
			so using this feature on the Web must be done with care
			as it can prevent accessibility tools
			from accessing the element’s semantics.</strong></p>
     <p>This value computes to <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display②④">display: none</a> on replaced elements
			and other elements whose rendering is not entirely controlled by CSS;
			see <a href="#unbox">Appendix B: Effects of display: contents on Unusual Elements</a> for details.</p>
     <p class="note" role="note"><span class="marker">Note:</span> Replaced elements and form controls are treated specially
			because removing only the element’s own generating box
			is a more-or-less undefined operation.
			As this behavior may be refined if use cases
			(and more precise rendering models) develop,
			authors should use <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display②⑤">display: none</a> rather than <span class="css" id="ref-for-propdef-display②⑥">display: contents</span> on such elements for forward-compatibility.</p>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-box>" data-dfn-type="value" data-export id="valdef-display-none">none</dfn> 
    <dd>
      The <a data-link-type="dfn" href="#elements" id="ref-for-elements⑥">element</a> and its descendants generate no <a data-link-type="dfn" href="#box" id="ref-for-box①⓪">boxes</a> or <a data-link-type="dfn" href="#css-text-sequence" id="ref-for-css-text-sequence⑦">text sequences</a>. 
     <p>Similarly, if a <a data-link-type="dfn" href="#text-nodes" id="ref-for-text-nodes⑤">text node</a> is defined to behave as <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display②⑦">display: none</a>,
			it generates no <a data-link-type="dfn" href="#css-text-sequence" id="ref-for-css-text-sequence⑧">text sequences</a>.</p>
   </dl>
   <p>Elements with either of these values do not have <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type①⓪">inner</a> or <a data-link-type="dfn" href="#outer-display-type" id="ref-for-outer-display-type⑨">outer display types</a>,
	because they don’t generate any boxes at all.</p>
   <p class="note" role="note"><span class="marker">Note:</span> As these values cause affected elements to not generate a box,
	anonymous box generation rules will ignore the elided elements entirely,
	as if they did not exist in the box tree.</p>
   <p>Markup-based relationships, however, are not affected by these values,
	as they are solely rendering-time effects. <span class="non-normative"> For example,
		although they may affect which table cell <em>appears</em> in a column,
		they do not affect which table cell is associated with a particular column <em>element</em>.
		Similarly, they cannot affect which HTML <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/interactive-elements.html#the-summary-element" id="ref-for-the-summary-element">summary</a></code> element is associated with a particular table
		or whether a <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-legend-element" id="ref-for-the-legend-element">legend</a></code> is considered to be labelling the contents of a particular <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-fieldset-element" id="ref-for-the-fieldset-element">fieldset</a></code>. </span></p>
   <h3 class="heading settled" data-level="2.6" id="legacy-display"><span class="secno">2.6. </span><span class="content"> Precomposed Inline-level Display Values</span><a class="self-link" href="#legacy-display"></a></h3>
<div data-valor-status="legacy-display">
 <p><strong>Status:</strong> [TODO]</p>
 <p><strong>Code:</strong> <em>Unimplemented</em></p>
 <p><strong>Fixtures:</strong> <em>None</em></p>
</div>
   <p>CSS level 2 used a single-keyword syntax for <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display②⑧">display</a>,
	requiring separate keywords for block-level and inline-level variants of the same layout mode.
	These <a class="production css" data-link-type="type" href="#typedef-display-legacy" id="ref-for-typedef-display-legacy①" title="Expands to: inline-block | inline-flex | inline-grid | inline-table">&lt;display-legacy></a> keywords map as follows:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-legacy>" data-dfn-type="value" data-export id="valdef-display-inline-block">inline-block</dfn> 
    <dd> Computes to <span class="css">inline flow-root</span>. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-legacy>" data-dfn-type="value" data-export id="valdef-display-inline-table">inline-table</dfn> 
    <dd> Computes to <span class="css">inline table</span>. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-legacy>" data-dfn-type="value" data-export id="valdef-display-inline-flex">inline-flex</dfn> 
    <dd> Computes to <span class="css">inline flex</span>. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="display, <display-legacy>" data-dfn-type="value" data-export id="valdef-display-inline-grid">inline-grid</dfn> 
    <dd> Computes to <span class="css">inline grid</span>. 
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> Although these keywords and their equivalents compute to the same value,
	their <a data-link-type="dfn" href="https://www.w3.org/TR/css-cascade-5/#specified-value" id="ref-for-specified-value">specified values</a> remain distinct.</p>
   <p class="note" role="note"><span class="marker">Note:</span> The <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/cssom-1/#dom-window-getcomputedstyle" id="ref-for-dom-window-getcomputedstyle①">getComputedStyle()</a></code> serialization rules
	will always output these precomposed keywords
	rather than the equivalent two-keyword pairs
	due to the <a href="https://www.w3.org/TR/cssom-1/#serializing-css-values">shortest, most backwards-compatible serialization principle</a>.</p>
   <h3 class="heading settled" data-level="2.7" id="transformations"><span class="secno">2.7. </span><span class="content"> Automatic Box Type Transformations</span><a class="self-link" href="#transformations"></a></h3>
<div data-valor-status="transformations">
 <p><strong>Status:</strong> [MVP]</p>
 <p><strong>Code:</strong> <code>display::chapter2::part_2_7_transformations::used_display_for_child</code></p>
 <p><strong>Fixtures:</strong> <em>None</em></p>
</div>
   <p>Some layout effects require <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="blockify|blockification" id="blockify">blockification</dfn> or <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="inlinify|inlinification" id="inlinify">inlinification</dfn> of the box type,
	which sets the box’s <a data-link-type="dfn" href="https://www.w3.org/TR/css-cascade-5/#computed-value" id="ref-for-computed-value①">computed</a> <a data-link-type="dfn" href="#outer-display-type" id="ref-for-outer-display-type①⓪">outer display type</a> to <a class="css" data-link-type="maybe" href="#valdef-display-block" id="ref-for-valdef-display-block⑤">block</a> or <a class="css" data-link-type="maybe" href="#valdef-display-inline" id="ref-for-valdef-display-inline⑦">inline</a> (respectively).
	(This has no effect on <a data-link-type="dfn" href="#display-type" id="ref-for-display-type②">display types</a> that generate no box at all,
	such as <a class="css" data-link-type="maybe" href="#valdef-display-none" id="ref-for-valdef-display-none⑤">none</a> or <a class="css" data-link-type="maybe" href="#valdef-display-contents" id="ref-for-valdef-display-contents③">contents</a>.)
	Additionally:</p>
   <ul>
    <li data-md>
     <p>If a <a data-link-type="dfn" href="#block-box" id="ref-for-block-box⑤">block box</a> (<span class="css">block flow</span>) is <a data-link-type="dfn" href="#inlinify" id="ref-for-inlinify">inlinified</a>,
its <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type①①">inner display type</a> is set to <a class="css" data-link-type="maybe" href="#valdef-display-flow-root" id="ref-for-valdef-display-flow-root⑥">flow-root</a> so that it remains a block container.</p>
    <li data-md>
     <p>If an <a data-link-type="dfn" href="#inline-box" id="ref-for-inline-box⑤">inline box</a> (<span class="css">inline flow</span>) is <a data-link-type="dfn" href="#inlinify" id="ref-for-inlinify①">inlinified</a>,
it recursively <span id="ref-for-inlinify②">inlinifies</span> all of its in-flow children,
so that no block-level descendants
break up the inline formatting context in which it participates.</p>
    <li data-md>
     <p>For legacy reasons,
if an <a data-link-type="dfn" href="#inline-block" id="ref-for-inline-block">inline block box</a> (<span class="css">inline flow-root</span>)
is <a data-link-type="dfn" href="#blockify" id="ref-for-blockify">blockified</a>,
it becomes a <a class="css" data-link-type="maybe" href="#valdef-display-block" id="ref-for-valdef-display-block⑥">block</a> box
(losing its <a class="css" data-link-type="maybe" href="#valdef-display-flow-root" id="ref-for-valdef-display-flow-root⑦">flow-root</a> nature).
For consistency,
a <span class="css">run-in flow-root</span> box
also <span id="ref-for-blockify①">blockifies</span> to a <span class="css" id="ref-for-valdef-display-block⑦">block</span> box.</p>
    <li data-md>
     <p>If a <a data-link-type="dfn" href="#layout-internal" id="ref-for-layout-internal③">layout-internal</a> box is <a data-link-type="dfn" href="#blockify" id="ref-for-blockify②">blockified</a>,
its <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type①②">inner display type</a> converts to <a class="css" data-link-type="maybe" href="#valdef-display-flow" id="ref-for-valdef-display-flow⑤">flow</a> so that it becomes a <a data-link-type="dfn" href="#block-container" id="ref-for-block-container⑥">block container</a>. <a data-link-type="dfn" href="#inlinify" id="ref-for-inlinify③">Inlinification</a> has no effect on <span id="ref-for-layout-internal④">layout-internal</span> boxes.
(However, placement in such an inline context
will typically cause them to be wrapped
in an appropriately-typed anonymous inline-level box.)</p>
   </ul>
   <p class="note" role="note"><span class="marker">Note:</span> There are two methods used to fix up box types when a box is mismatched to its context.
	One is transformation of the <a data-link-type="dfn" href="https://www.w3.org/TR/css-cascade-5/#computed-value" id="ref-for-computed-value②">computed value</a> of <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display②⑨">display</a>, such as <a data-link-type="dfn" href="#blockify" id="ref-for-blockify③">blockification</a> and <a data-link-type="dfn" href="#inlinify" id="ref-for-inlinify④">inlinification</a> described here.
	The other, taking place during <a href="#intro">box tree construction</a> (after computed values have been determined),
	is the creation of intermediary anonymous boxes,
	such as happens in <a href="https://www.w3.org/TR/CSS2/tables.html#anonymous-boxes">tables</a>, <a href="https://www.w3.org/TR/css-ruby-1/#box-fixup">ruby</a>,
	and <a href="https://www.w3.org/TR/CSS21/visuren.html#box-gen">flow</a> layout.</p>
   <div class="example" id="example-26cc3423">
    <a class="self-link" href="#example-26cc3423"></a> Some examples of computed-value fixup include: 
    <ul>
     <li>Absolute positioning or floating an element <a data-link-type="dfn" href="#blockify" id="ref-for-blockify④">blockifies</a> the box’s display type. <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> 
     <li>Containment in a <a data-link-type="dfn" href="https://www.w3.org/TR/css-ruby-1/#ruby-container" id="ref-for-ruby-container③">ruby container</a> <a data-link-type="dfn" href="#inlinify" id="ref-for-inlinify⑤">inlinifies</a> the box’s display type, as described in <a data-link-type="biblio" href="#biblio-css-ruby-1" title="CSS Ruby Annotation Layout Module Level 1">[CSS-RUBY-1]</a>. 
     <li>A parent with a <a class="css" data-link-type="maybe" href="#valdef-display-grid" id="ref-for-valdef-display-grid②">grid</a> or <a class="css" data-link-type="maybe" href="#valdef-display-flex" id="ref-for-valdef-display-flex②">flex</a> <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display③⓪">display</a> value <a data-link-type="dfn" href="#blockify" id="ref-for-blockify⑤">blockifies</a> the box’s display type. <a data-link-type="biblio" href="#biblio-css-grid-1" title="CSS Grid Layout Module Level 1">[CSS-GRID-1]</a> <a data-link-type="biblio" href="#biblio-css-flexbox-1" title="CSS Flexible Box Layout Module Level 1">[CSS-FLEXBOX-1]</a> 
    </ul>
   </div>
   <h3 class="heading settled" data-level="2.8" id="root"><span class="secno">2.8. </span><span class="content"> The Root Element’s Principal Box</span><a class="self-link" href="#root"></a></h3>
<div data-valor-status="root">
 <p><strong>Status:</strong> [TODO]</p>
 <p><strong>Code:</strong> <em>Unimplemented</em></p>
 <p><strong>Fixtures:</strong> <em>None</em></p>
</div>
   <p>The <a data-link-type="dfn" href="#root-element" id="ref-for-root-element">root element</a>’s display type is always <a data-link-type="dfn" href="#blockify" id="ref-for-blockify⑥">blockified</a>,
	and its <a data-link-type="dfn" href="#principal-box" id="ref-for-principal-box⑧">principal box</a> always establishes an <a data-link-type="dfn" href="#independent-formatting-context" id="ref-for-independent-formatting-context">independent formatting context</a>.
	This box’s <a data-link-type="dfn" href="#containing-block" id="ref-for-containing-block">containing block</a> is the <a data-link-type="dfn" href="#initial-containing-block" id="ref-for-initial-containing-block">initial containing block</a>.</p>
   <p>Additionally, a <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display③①">display</a> of <a class="css" data-link-type="maybe" href="#valdef-display-contents" id="ref-for-valdef-display-contents④">contents</a> computes to <a class="css" data-link-type="maybe" href="#valdef-display-block" id="ref-for-valdef-display-block⑧">block</a> on the root element.</p>
   <h2 class="heading settled" data-level="3" id="order-property"><span class="secno">3. </span><span class="content"> Display Order: the <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order">order</a> property</span><a class="self-link" href="#order-property"></a></h2>
<div data-valor-status="order-property">
 <p><strong>Status:</strong> [TODO]</p>
 <p><strong>Code:</strong> <em>Unimplemented</em></p>
 <p><strong>Fixtures:</strong> <em>None</em></p>
</div>
   <table class="def propdef" data-link-for-hint="order">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-order">order</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod"><a class="production css" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#integer-value" id="ref-for-integer-value">&lt;integer></a> 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>0 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a data-link-type="dfn" href="https://www.w3.org/TR/css-flexbox-1/#flex-item" id="ref-for-flex-item">flex items</a> and <a data-link-type="dfn" href="https://www.w3.org/TR/css-grid-2/#grid-item" id="ref-for-grid-item">grid items</a> 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>no 
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>n/a 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>specified integer 
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar 
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>by computed value type 
   </table>
   <p>Boxes are generally displayed and laid out
	in the same order as they appear in the source document.
	In some <a data-link-type="dfn" href="#formatting-context" id="ref-for-formatting-context④">formatting contexts</a>,
	the <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order①">order</a> property can be used to rearrange the order of boxes
	to deliberately create a divergence
	of the logical order of elements
	and their spatial arrangement on the 2D visual canvas.
	(See <a href="#order-accessibility">§ 3.1 Reordering and Accessibility</a>.)</p>
   <p>Specifically,
	the <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order②">order</a> property controls the order in which <a data-link-type="dfn" href="https://www.w3.org/TR/css-flexbox-1/#flex-item" id="ref-for-flex-item①">flex items</a> or <a data-link-type="dfn" href="https://www.w3.org/TR/css-grid-2/#grid-item" id="ref-for-grid-item①">grid items</a> appear within their container,
	by assigning them to ordinal groups.
	It takes a single <dfn class="css" data-dfn-for="order" data-dfn-type="value" data-export id="valdef-order-integer"><a class="production css" data-link-type="type" href="https://www.w3.org/TR/css-values-4/#integer-value" id="ref-for-integer-value①">&lt;integer></a><a class="self-link" href="#valdef-order-integer"></a></dfn> value,
	which specifies which ordinal group the item belongs to.</p>
   <div class="example" id="example-84ef28f3">
    <a class="self-link" href="#example-84ef28f3"></a> Here’s an example of a catalog item card
		which has a title, a photo, and a description.
		Within each entry, the source document content is ordered logically
		with the title first, followed by the description and the photo.
		This provides a sensible ordering for speech rendering and in non-CSS browsers.
		For a more compelling visual presentation, however, <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order③">order</a> is used to pull the image up from later in the content to the top of the card. 
<pre class="lang-css highlight">article.sale-item <c- p>{</c->
  <c- k>display</c-><c- p>:</c-> flex<c- p>;</c->
  <c- k>flex-flow</c-><c- p>:</c-> column<c- p>;</c->
<c- p>}</c->
article.sale-item > img <c- p>{</c->
  <c- k>order</c-><c- p>:</c-> <c- m>-1</c-><c- p>;</c-> <c- c>/* Shift image before other content (in layout order) */</c->
  align-self: center<c- p>;</c->
<c- p>}</c->
</pre>
<pre class="lang-markup highlight"><c- p>&lt;</c-><c- f>article</c-> <c- e>class</c-><c- o>=</c-><c- s>"sale-item"</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>h1</c-><c- p>></c->Computer Starter Kit<c- p>&lt;/</c-><c- f>h1</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>p</c-><c- p>></c->This is the best computer money can buy, if you don’t have much money.
  <c- p>&lt;</c-><c- f>ul</c-><c- p>></c->
    <c- p>&lt;</c-><c- f>li</c-><c- p>></c->Computer
    <c- p>&lt;</c-><c- f>li</c-><c- p>></c->Monitor
    <c- p>&lt;</c-><c- f>li</c-><c- p>></c->Keyboard
    <c- p>&lt;</c-><c- f>li</c-><c- p>></c->Mouse
  <c- p>&lt;/</c-><c- f>ul</c-><c- p>></c->
  <c- p>&lt;</c-><c- f>img</c-> <c- e>src</c-><c- o>=</c-><c- s>"images/computer.jpg"</c->
    <c- e>alt</c-><c- o>=</c-><c- s>"You get: a white desktop computer with matching peripherals."</c-><c- p>></c->
<c- p>&lt;/</c-><c- f>article</c-><c- p>></c->
</pre>
    <figure>
     <div id="order-example">
       <img alt="You get: a white desktop computer with matching keyboard and monitor." height="188" src="images/computer.jpg" width="250"> 
      <h1 id="quiet-pubrules-1" style="font-size: 1.4em;">Computer Starter Kit</h1>
      <p> This is the best computer money can buy,
					if you don’t have much money. </p>
      <ul>
       <li>Computer 
       <li>Monitor 
       <li>Keyboard 
       <li>Mouse 
      </ul>
     </div>
     <figcaption> An example rendering of the code above. </figcaption>
    </figure>
   </div>
   <p><a data-link-type="dfn" href="https://www.w3.org/TR/css-flexbox-1/#flex-container" id="ref-for-flex-container③">Flex</a> and <a data-link-type="dfn" href="https://www.w3.org/TR/css-grid-2/#grid-container" id="ref-for-grid-container③">grid containers</a> lay out their contents
	in <dfn data-dfn-type="dfn" data-export id="order-modified-document-order">order-modified document order<a class="self-link" href="#order-modified-document-order"></a></dfn>,
	starting from the lowest numbered ordinal group and going up.
	Items with the same ordinal group are laid out in the order they appear in the source document.
	This also affects the <a href="https://www.w3.org/TR/CSS2/zindex.html">painting order</a> <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a>,
	exactly as if the <a data-link-type="dfn" href="https://www.w3.org/TR/css-flexbox-1/#flex-item" id="ref-for-flex-item②">flex</a>/<a data-link-type="dfn" href="https://www.w3.org/TR/css-grid-2/#grid-item" id="ref-for-grid-item②">grid items</a> were reordered in the source document.
	Absolutely-positioned children of a <span id="ref-for-flex-container④">flex</span>/<span id="ref-for-grid-container④">grid container</span> are treated as having <a class="css" data-link-type="propdesc" href="#propdef-order" id="ref-for-propdef-order④">order: 0</a> for the purpose of determining their painting order relative to <span id="ref-for-flex-item③">flex</span>/<span id="ref-for-grid-item③">grid items</span>.</p>
   <p>Unless otherwise specified by a future specification,
	this property has no effect on boxes that are not <a data-link-type="dfn" href="https://www.w3.org/TR/css-flexbox-1/#flex-item" id="ref-for-flex-item④">flex items</a> or <a data-link-type="dfn" href="https://www.w3.org/TR/css-grid-2/#grid-item" id="ref-for-grid-item④">grid items</a>.</p>
   <h3 class="heading settled" data-level="3.1" id="order-accessibility"><span class="secno">3.1. </span><span class="content"> Reordering and Accessibility</span><a class="self-link" href="#order-accessibility"></a></h3>
   <p>The <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order⑤">order</a> property <em>does not</em> affect ordering in non-visual media
	(such as <a href="https://www.w3.org/TR/css-speech-1/">speech</a>).
	Likewise, <span class="property" id="ref-for-propdef-order⑥">order</span> does not affect
	the default traversal order of sequential navigation modes
	(such as cycling through links, see e.g. <a href="https://html.spec.whatwg.org/multipage/interaction.html#attr-tabindex"><code>tabindex</code></a> <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>).</p>
   <p><strong class="advisement"> Authors <em>must</em> use <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order⑦">order</a> only for spatial, not logical, reordering of content.
	Style sheets that use <span class="property" id="ref-for-propdef-order⑧">order</span> to perform logical reordering are non-conforming.</strong></p>
   <p class="note" role="note"><span class="marker">Note:</span> This is so that non-visual media and non-CSS UAs,
	which typically present content linearly,
	can rely on a logical source order,
	while <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order⑨">order</a> is used to tailor the layout order.
	(Since visual perception is two-dimensional and non-linear,
	the desired layout order is not always logical.)</p>
   <p>In order to preserve the author’s intended ordering in all presentation modes,
	authoring tools—<wbr>including WYSIWYG editors as well as Web-based authoring aids—<wbr>must reorder the underlying document source
	and not use <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order①⓪">order</a> to perform reordering
	unless the author has explicitly indicated that
	the spatial order should be <em>out-of-sync</em> with
	the underlying document order (which determines speech and navigation order).</p>
   <div class="example" id="example-b20b6e0a">
    <a class="self-link" href="#example-b20b6e0a"></a> For example, a tool might offer both drag-and-drop reordering of flex items
		as well as handling of media queries for alternate layouts per screen size range. 
    <p>Since most of the time, reordering should affect all screen ranges
		as well as navigation and speech order,
		the tool would perform drag-and-drop reordering at the DOM layer.
		In some cases, however, the author may want different layouts per screen size.
		The tool could offer this functionality by using <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order①①">order</a> together with media queries,
		but also tie the smallest screen size’s ordering to the underlying DOM order
		(since this is most likely to be a logical linear presentation order)
		while using <span class="property" id="ref-for-propdef-order①②">order</span> to define the visual presentation order in other size ranges.</p>
    <p>This tool would be conformant, whereas a tool that only ever used <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order①③">order</a> to handle drag-and-drop reordering
		(however convenient it might be to implement it that way)
		would be non-conformant.</p>
   </div>
   <p class="note" role="note"><span class="marker">Note:</span> User agents, including browsers, accessible technology, and extensions,
	may offer spatial navigation features.
	This section does not preclude respecting the <a class="property css" data-link-type="property" href="#propdef-order" id="ref-for-propdef-order①④">order</a> property
	when determining element ordering in such spatial navigation modes;
	indeed it would need to be considered for such a feature to work.
	But <span class="property" id="ref-for-propdef-order①⑤">order</span> is not the only (or even the primary) CSS property
	that would need to be considered for such a spatial navigation feature.
	A well-implemented spatial navigation feature would need to consider
	all the layout features of CSS that modify spatial relationships.</p>
   <h2 class="heading settled" data-level="4" id="visibility"><span class="secno">4. </span><span class="content"> Invisibility: the <a class="property css" data-link-type="property" href="#propdef-visibility" id="ref-for-propdef-visibility">visibility</a> property</span><a class="self-link" href="#visibility"></a></h2>
<div data-valor-status="visibility">
 <p><strong>Status:</strong> [TODO]</p>
 <p><strong>Code:</strong> <em>Unimplemented</em></p>
 <p><strong>Fixtures:</strong> <em>None</em></p>
</div>
   <table class="def propdef" data-link-for-hint="visibility">
    <tbody>
     <tr>
      <th>Name:
      <td><dfn class="dfn-paneled css" data-dfn-type="property" data-export id="propdef-visibility">visibility</dfn>
     <tr class="value">
      <th><a href="https://www.w3.org/TR/css-values/#value-defs">Value:</a>
      <td class="prod">visible <a data-link-type="grammar" href="https://www.w3.org/TR/css-values-4/#comb-one" id="ref-for-comb-one②⑦">|</a> hidden <span id="ref-for-comb-one②⑧">|</span> collapse 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#initial-values">Initial:</a>
      <td>visible 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#applies-to">Applies to:</a>
      <td><a href="https://www.w3.org/TR/css-pseudo/#generated-content" title="Includes ::before and ::after pseudo-elements.">all elements</a> 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#inherited-property">Inherited:</a>
      <td>yes 
     <tr>
      <th><a href="https://www.w3.org/TR/css-values/#percentages">Percentages:</a>
      <td>N/A 
     <tr>
      <th><a href="https://www.w3.org/TR/css-cascade/#computed">Computed value:</a>
      <td>as specified 
     <tr>
      <th><a href="https://www.w3.org/TR/cssom/#serializing-css-values">Canonical order:</a>
      <td>per grammar 
     <tr>
      <th><a href="https://www.w3.org/TR/web-animations/#animation-type">Animation type:</a>
      <td>discrete 
     <tr>
      <th>Media:
      <td>visual 
   </table>
   <p>The <a class="property css" data-link-type="property" href="#propdef-visibility" id="ref-for-propdef-visibility①">visibility</a> property specifies whether the box is rendered. <a data-link-type="dfn" href="#invisible" id="ref-for-invisible">Invisible</a> boxes still affect layout.
	(Set the <a class="property css" data-link-type="property" href="#propdef-display" id="ref-for-propdef-display③②">display</a> property to <a class="css" data-link-type="maybe" href="#valdef-display-none" id="ref-for-valdef-display-none⑥">none</a> to suppress box generation altogether.).
	Values have the following meanings:</p>
   <dl>
    <dt><dfn class="dfn-paneled css" data-dfn-for="visibility" data-dfn-type="value" data-export id="valdef-visibility-visible">visible</dfn> 
    <dd> The generated box is visible, as normal. 
    <dt><dfn class="dfn-paneled css" data-dfn-for="visibility" data-dfn-type="value" data-export id="valdef-visibility-hidden">hidden</dfn> 
    <dd> Any boxes generated by the element are <a data-link-type="dfn" href="#invisible" id="ref-for-invisible①">invisible</a>.
			Descendants of the element can, however, be visible
			if they have <a class="css" data-link-type="propdesc" href="#propdef-visibility" id="ref-for-propdef-visibility②">visibility: visible</a>. 
    <dt><dfn class="css" data-dfn-for="visibility" data-dfn-type="value" data-export id="valdef-visibility-collapse">collapse<a class="self-link" href="#valdef-visibility-collapse"></a></dfn> 
    <dd> Indicates that the box is <dfn data-dfn-for data-dfn-type="dfn" data-noexport id="collapsed">collapsed<a class="self-link" href="#collapsed"></a></dfn>,
			which can cause it to take up less space than otherwise
			in a formatting-context–specific way.
			See <a href="https://www.w3.org/TR/CSS2/tables.html#dynamic-effects">dynamic row and column effects in tables</a> <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a> and <a href="https://www.w3.org/TR/css-flexbox-1/#visibility-collapse">collapsed flex items</a> in flex layout <a data-link-type="biblio" href="#biblio-css-flexbox-1" title="CSS Flexible Box Layout Module Level 1">[CSS-FLEXBOX-1]</a>.
			In all other cases, however,
			(i.e. unless otherwise specified)
			this simply makes the box <a data-link-type="dfn" href="#invisible" id="ref-for-invisible②">invisible</a>,
			just like <a class="css" data-link-type="maybe" href="#valdef-visibility-hidden" id="ref-for-valdef-visibility-hidden">hidden</a>. 
   </dl>
   <p class="note" role="note"><span class="marker">Note:</span> Currently, many user agents and/or accessibility tools
	don’t correctly implement the accessibility implications of
	visible elements with semantic relationships to <a data-link-type="dfn" href="#invisible" id="ref-for-invisible③">invisible</a> elements,
	so, for example,
	making parent elements with special roles (such as table rows) <span id="ref-for-invisible④">invisible</span> while leaving child elements with special roles (such as table cells) visible
	can be problematic for users of those tools.
	Authors should avoid creating these situations
	until the tooling situation improves.</p>
   <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="invisible">Invisible</dfn> boxes are not rendered
	(as if they were fully transparent),
	cannot be interacted with
	(and behave as if they had <a class="css" data-link-type="propdesc" href="https://drafts.csswg.org/css-ui-4/#propdef-pointer-events" id="ref-for-propdef-pointer-events">pointer-events: none</a>),
	are removed from navigation
	(similar to <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display③③">display: none</a>),
	and are also not rendered to speech
	(except when <a class="property css" data-link-type="property" href="https://www.w3.org/TR/CSS21/aural.html#propdef-speak" id="ref-for-propdef-speak">speak</a> is <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-speech-1/#valdef-speak-always" id="ref-for-valdef-speak-always">always</a> <a data-link-type="biblio" href="#biblio-css-speech-1" title="CSS Speech Module Level 1">[CSS-SPEECH-1]</a>).
	However, as with <span class="css" id="ref-for-propdef-display③④">display: contents</span>,
	their semantic role as a container is not affected,
	to ensure that any <a class="css" data-link-type="maybe" href="#valdef-visibility-visible" id="ref-for-valdef-visibility-visible">visible</a> descendants
	are properly interpreted.</p>
   <p class="note" role="note"><span class="marker">Note:</span> If <a class="property css" data-link-type="property" href="https://www.w3.org/TR/CSS21/aural.html#propdef-speak" id="ref-for-propdef-speak①">speak</a> is <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-speech-1/#valdef-speak-always" id="ref-for-valdef-speak-always①">always</a>,
	an otherwise <a data-link-type="dfn" href="#invisible" id="ref-for-invisible⑤">invisible</a> box <em>is</em> rendered to speech,
	and may be interacted with using non-visual/spatial methods.</p>
   <div class="example" id="example-45900d89">
    <a class="self-link" href="#example-45900d89"></a> While temporarily hiding things with <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display③⑤">display: none</a> is often sufficient,
		doing so removes the elements from layout entirely,
		possibly causing unwanted movement or reflow of the page
		when an element is hidden or shown. <a class="css" data-link-type="propdesc" href="#propdef-visibility" id="ref-for-propdef-visibility③">visibility: hidden</a> can instead be used
		to keep the page’s layout stable
		as something is hidden and displayed. 
    <p>For example,
		here is a (deliberately simplified) possible implementation of a "spoiler" element
		that can be revealed by clicking on the hidden text:</p>
<pre class="highlight"><c- p>&lt;</c-><c- f>p</c-><c- p>></c->The symbolism earlier in the movie becomes obvious at the end,
  when it’s revealed that <c- p>&lt;</c-><c- f>spoiler-text</c-><c- p>>&lt;</c-><c- f>span</c-><c- p>></c->Luke is his own father<c- p>&lt;/</c-><c- f>span</c-><c- p>>&lt;/</c-><c- f>spoiler-text</c-><c- p>></c->,
  making the wizard’s cryptic riddles meaningful.
<c- p>&lt;</c-><c- f>style</c-><c- p>></c->
<c- f>spoiler-text</c-> <c- p>{</c-> <c- k>border-bottom</c-><c- p>:</c-> <c- mi>1</c-><c- b>px</c-> <c- kc>solid</c-><c- p>;</c-> <c- p>}</c->
<c- f>spoiler-text</c-> <c- o>></c-> <c- f>span</c-> <c- p>{</c-> <c- k>visibility</c-><c- p>:</c-> <c- kc>hidden</c-><c- p>;</c-> <c- p>}</c->
<c- f>spoiler-text</c-><c- p>.</c-><c- nc>shown</c-> <c- o>></c-> <c- f>span</c-> <c- p>{</c-> <c- k>visibility</c-><c- p>:</c-> <c- kc>visible</c-><c- p>;</c-> <c- p>}</c->
<c- p>&lt;/</c-><c- f>style</c-><c- p>></c->
<c- p>&lt;</c-><c- f>script</c-><c- p>></c->
<c- p>[...</c->document<c- p>.</c->querySelectorAll<c- p>(</c-><c- u>"spoiler-text"</c-><c- p>)].</c->forEach<c- p>(</c->el<c- p>=>{</c->
  el<c- p>.</c->addEventListener<c- p>(</c-><c- u>"click"</c-><c- p>,</c-> e<c- p>=></c->el<c- p>.</c->classList<c- p>.</c->toggle<c- p>(</c-><c- u>"shown"</c-><c- p>));</c->
<c- p>});</c->
<c- p>&lt;/</c-><c- f>script</c-><c- p>></c->
</pre>
    <p><strong class="advisement"> This example is deliberately significantly simplified.
   </div>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="run-in | run-in box" id="run-in">run-in box</dfn> is a box that <em>merges into</em> a block that comes after it,
	inserting itself at the beginning of that block’s inline-level content.
	This is useful for formatting compact headlines, definitions, and other similar things,
	where the appropriate DOM structure is to have a headline preceding the following prose,
	but the desired display is an inline headline laying out with the text.</p>
   <div class="example" id="example-8e61beaa">
    <a class="self-link" href="#example-8e61beaa"></a> For example, dictionary definitions are often formatted so that the word is inline with the definition: 
<pre>&lt;dl class='dict'>
  &lt;dt>dictionary
  &lt;dd>a book that lists the words of a language in alphabetical
      order and gives their meaning, or that gives the equivalent
      words in a different language.
  &lt;dt>glossary
  &lt;dd>an alphabetical list of terms or words found in or relating
      to a specific subject, text, or dialect, with explanations; a
      brief dictionary.
&lt;/dl>
&lt;style>
.dict > dt {
  display: run-in;
}
.dict > dt::after {
  content: ": "
}
&lt;/style>
</pre>
    <p>Which is formatted as:</p>
<pre><b>dictionary:</b> a book that lists the words of a language
in alphabetical order and explains their meaning.

<b>glossary:</b> an alphabetical list of terms or words found
in or relating to a specific subject, text, or dialect,
with explanations; a brief dictionary.
</pre>
   </div>
   <p>A <a data-link-type="dfn" href="#run-in" id="ref-for-run-in②">run-in box</a> behaves exactly as any other <a data-link-type="dfn" href="#inline-level-box" id="ref-for-inline-level-box①">inline-level box</a>, except:</p>
   <ul>
    <li> A <a data-link-type="dfn" href="#run-in" id="ref-for-run-in③">run-in box</a> with a <a class="css" data-link-type="maybe" href="#valdef-display-flow" id="ref-for-valdef-display-flow⑥">flow</a> <a data-link-type="dfn" href="#inner-display-type" id="ref-for-inner-display-type①③">inner display type</a> <a data-link-type="dfn" href="#inlinify" id="ref-for-inlinify⑥">inlinifies</a> its contents. 
    <li>
      If a <a data-link-type="dfn" href="#run-in-sequence" id="ref-for-run-in-sequence">run-in sequence</a> is immediately followed by a block box
			that does not establish a new <a data-link-type="dfn" href="#block-formatting-context" id="ref-for-block-formatting-context⑥">block formatting context</a>,
			it is inserted as direct children of that block box:
			after its <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-pseudo-4/#selectordef-marker" id="ref-for-selectordef-marker②">::marker</a> pseudo-element’s boxes (if any),
			but preceding any other boxes generated by the contents of the block
			(including the box generated by the <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-pseudo-4/#selectordef-before" id="ref-for-selectordef-before①">::before</a> pseudo-element, if any).
			This re-parenting recurses if possible
			(so that the run-in effectively becomes
			part of the deepest subsequent “paragraph” in its formatting context,
			collecting newly-adjacent run-ins as it goes). 
     <p>The reparented content is then formatted as if originally parented there. <span class="note">Note that only layout is affected, not inheritance,
			because property inheritance for non-anonymous boxes is based only on the element tree.</span></p>
    <li> Otherwise
			(if the <a data-link-type="dfn" href="#run-in-sequence" id="ref-for-run-in-sequence①">run-in sequence</a> is <em>not</em> followed by such a block),
			an anonymous block box is generated around the <span id="ref-for-run-in-sequence②">run-in sequence</span> and all immediately following inline-level content
			(up to, but not including, the next <span id="ref-for-run-in-sequence③">run-in sequence</span>, if any). 
   </ul>
   <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="run-in-sequence">run-in sequence</dfn> is a maximal sequence of consecutive sibling <a data-link-type="dfn" href="#run-in" id="ref-for-run-in④">run-in boxes</a> and intervening <a data-link-type="dfn" href="https://www.w3.org/TR/css-text-4/#white-space" id="ref-for-white-space">white space</a> and/or out-of-flow boxes.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This statement implies that out-of-flow boxes are reparented
	if they are between two run-in boxes.
	Another alternative would be to leave behind the intervening out-of-flow boxes,
	or to have out-of-flow boxes impede the running-in of earlier boxes.
	Implementers and authors are encouraged to contact the CSSWG if they have a preferred behavior, as this one was picked somewhat at random.</p>
   <p>This fixup occurs before the anonymous block and inline box fixup described in <a href="https://www.w3.org/TR/CSS21/visuren.html#box-gen">CSS2§9.2</a>,
	and affects the determination of the <a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#first-formatted-line" id="ref-for-first-formatted-line">first formatted line</a> of the affected elements
	as if the <a data-link-type="dfn" href="#run-in-sequence" id="ref-for-run-in-sequence④">run-in sequence</a> were originally
	in its final location in the box tree.</p>
   <p class="note" role="note"><span class="marker">Note:</span> As the earliest run-in represents the first text on the <a data-link-type="dfn" href="https://www.w3.org/TR/css-pseudo-4/#first-formatted-line" id="ref-for-first-formatted-line①">first formatted line</a> of its containing block,
	a <a class="css" data-link-type="maybe" href="https://www.w3.org/TR/css-pseudo-4/#selectordef-first-letter" id="ref-for-selectordef-first-letter①">::first-letter</a> pseudo-element applied to that block element
	selects the first letter of the run-in,
	rather than the first letter of its own contents.</p>
   <p class="note" role="note"><span class="marker">Note:</span> This run-in model is slightly different from the one proposed in earlier revisions of <a data-link-type="biblio" href="#biblio-css2" title="Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification">[CSS2]</a>.</p>
   <h2 class="no-num non-normative heading settled" id="unbox"><span class="content"> Appendix B: Effects of <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display③⑨">display: contents</a> on Unusual Elements</span><a class="self-link" href="#unbox"></a></h2>
   <p><em>This section is (currently) non-normative.</em></p>
   <p>Some elements aren’t rendered purely by CSS box concepts;
	for example, replaced elements (such as <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element" id="ref-for-the-img-element①">img</a></code>),
	many form controls (such as <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/input.html#the-input-element" id="ref-for-the-input-element">input</a></code>),
	and SVG elements.</p>
   <p>This appendix defines how they interact with <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display④⓪">display: contents</a>.</p>
   <h3 class="heading settled" id="unbox-html"><span class="content">HTML Elements</span><a class="self-link" href="#unbox-html"></a></h3>
   <dl>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-br-element" id="ref-for-the-br-element">br</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-wbr-element" id="ref-for-the-wbr-element">wbr</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-meter-element" id="ref-for-the-meter-element">meter</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-progress-element" id="ref-for-the-progress-element">progress</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/canvas.html#canvas" id="ref-for-canvas">canvas</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-embed-element" id="ref-for-the-embed-element">embed</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-object-element" id="ref-for-the-object-element">object</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/media.html#audio" id="ref-for-audio">audio</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-img-element" id="ref-for-the-img-element②">img</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/media.html#video" id="ref-for-video">video</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/obsolete.html#frame" id="ref-for-frame">frame</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/obsolete.html#frameset" id="ref-for-frameset">frameset</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/input.html#the-input-element" id="ref-for-the-input-element①">input</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-textarea-element" id="ref-for-the-textarea-element">textarea</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-select-element" id="ref-for-the-select-element">select</a></code>
    <dd data-md>
     <p><a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display④①">display: contents</a> computes to <span class="css" id="ref-for-propdef-display④②">display: none</span>.</p>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-legend-element" id="ref-for-the-legend-element①">legend</a></code>
    <dd data-md>
     <p>Per HTML, a <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-legend-element" id="ref-for-the-legend-element②">legend</a></code> with <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display④③">display: contents</a> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/rendering.html#rendered-legend" id="ref-for-rendered-legend">rendered legend</a>,
so it does not have magical display behavior.
(Thus, it reacts to <span class="css" id="ref-for-propdef-display④④">display: contents</span> normally.)</p>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-button-element" id="ref-for-the-button-element">button</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/interactive-elements.html#the-details-element" id="ref-for-the-details-element">details</a></code>
    <dt data-md><code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/form-elements.html#the-fieldset-element" id="ref-for-the-fieldset-element①">fieldset</a></code>
    <dd data-md>
     <p>These elements don’t have any special behavior; <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display④⑤">display: contents</a> simply removes their <a data-link-type="dfn" href="#principal-box" id="ref-for-principal-box①①">principal box</a>,
and their contents render as normal.</p>
    <dt data-md>any other HTML element
    <dd data-md>
     <p>Behaves as normal for <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display④⑥">display: contents</a>.</p>
   </dl>
   <h3 class="heading settled" id="unbox-svg"><span class="content">SVG Elements</span><a class="self-link" href="#unbox-svg"></a></h3>
   <dl>
    <dt data-md>An <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/struct.html#elementdef-svg" id="ref-for-elementdef-svg">svg</a></code> element that has CSS box layout
(this includes all <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/struct.html#elementdef-svg" id="ref-for-elementdef-svg①">svg</a></code> whose parent is an HTML element,
as well as document root elements)
    <dd data-md>
     <p><a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display④⑦">display: contents</a> computes to <span class="css" id="ref-for-propdef-display④⑧">display: none</span>.</p>
    <dt data-md>All other SVG <a data-link-type="dfn" href="https://www.w3.org/TR/SVG2/struct.html#container-element" id="ref-for-container-element">container elements</a> that are also <a data-link-type="dfn" href="https://www.w3.org/TR/SVG2/render.html#TermRenderableElement" id="ref-for-TermRenderableElement">renderable elements</a>
    <dt data-md>SVG <a data-link-type="dfn" href="https://svgwg.org/svg2-draft/text.html#TermTextContentChildElement" id="ref-for-TermTextContentChildElement">text content child elements</a>
    <dt data-md><code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/struct.html#elementdef-use" id="ref-for-elementdef-use">use</a></code>
    <dd data-md>
     <p><a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display④⑨">display: contents</a> strips the element from the formatting tree,
and hoists its contents up to display in its place.
These contents include the shadow-DOM content for <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/struct.html#elementdef-use" id="ref-for-elementdef-use①">use</a></code>.</p>
    <dt data-md>any other SVG elements
    <dd data-md>
     <p><a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display⑤⓪">display: contents</a> computes to <span class="css" id="ref-for-propdef-display⑤①">display: none</span>.</p>
   </dl>
   <div class="note" role="note">
     The intention here is that
		the <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display⑤②">display: none</a> behavior applies
		whenever the "rendering context" inside the element
		is different than the context outside of it.
		If the element’s child elements would not be valid children
		of the element’s parent,
		you cannot simply hoist them up the formatting tree. 
    <p>For example, text content and text formatting elements in SVG
		require a <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/text.html#elementdef-text" id="ref-for-elementdef-text">text</a></code> element context;
		if you remove a <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/text.html#elementdef-text" id="ref-for-elementdef-text①">text</a></code>,
		its child text content and elements are no longer valid.
		For that reason, <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display⑤③">display: contents</a> on <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/text.html#elementdef-text" id="ref-for-elementdef-text②">text</a></code> prevents the entire text element from being rendered.
		In contrast, any valid content inside a <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/text.html#elementdef-tspan" id="ref-for-elementdef-tspan">tspan</a></code> or <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/text.html#elementdef-textPath" id="ref-for-elementdef-textPath">textPath</a></code> is also valid content inside the parent text formatting context,
		so the hoisting behavior applies for these elements.</p>
    <p>Similarly, if hoisting would convert the children from <a data-link-type="dfn" href="https://www.w3.org/TR/SVG2/render.html#TermNonRenderedElement" id="ref-for-TermNonRenderedElement">non-rendered elements</a> (e.g., a shape inside a <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/pservers.html#elementdef-pattern" id="ref-for-elementdef-pattern">pattern</a></code> or <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/struct.html#elementdef-symbol" id="ref-for-elementdef-symbol">symbol</a></code>)
		to <a data-link-type="dfn" href="https://www.w3.org/TR/SVG2/render.html#TermRenderedElement" id="ref-for-TermRenderedElement">rendered elements</a> (e.g., a shape that is a direct child of the <code><a data-link-type="element" href="https://www.w3.org/TR/SVG2/struct.html#elementdef-svg" id="ref-for-elementdef-svg②">svg</a></code>),
		that is an invalid change of rendering context.
		Never-rendered container elements therefore cannot be "un-boxed"
		by <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display⑤④">display: contents</a>.</p>
   </div>
   <p>When an element is stripped from the formatting tree,
	then any SVG attributes on that element
	that control layout and visual formatting
	are ignored when rendering the contents.
	However, SVG <a data-link-type="dfn" href="https://www.w3.org/TR/SVG2/styling.html#TermPresentationAttribute" id="ref-for-TermPresentationAttribute">presentation attributes</a>—<wbr>which map to CSS properties—<wbr>continue to affect value processing and inheritance <a data-link-type="biblio" href="#biblio-css-cascade-3" title="CSS Cascading and Inheritance Level 3">[CSS-CASCADE-3]</a>;
	thus such attributes can affect
	the layout and visual formatting of the element’s descendants
	by influencing the values of such properties on those descendants.</p>
   <h3 class="heading settled" id="unbox-mathml"><span class="content">MathML Elements</span><a class="self-link" href="#unbox-mathml"></a></h3>
   <p>For all MathML elements, <a class="css" data-link-type="propdesc" href="#propdef-display" id="ref-for-propdef-display⑤⑤">display: contents</a> computes to <span class="css" id="ref-for-propdef-display⑤⑥">display: none</span>.</p>
   <h2 class="no-num heading settled" id="box-guidelines"><span class="content"> Appendix C: Box Construction Guidelines for Spec Authors</span><a class="self-link" href="#box-guidelines"></a></h2>
   <p><em>This section is non-normative guidance for specification authors.</em></p>
   <ul>
    <li data-md>
     <p>A box cannot be <a data-link-type="dfn" href="#blockify" id="ref-for-blockify⑧">blockified</a> and <a data-link-type="dfn" href="#inlinify" id="ref-for-inlinify⑦">inlinified</a> at the same time;
if such a thing would occur,
define which wins over the other.</p>
    <li data-md>
     <p>Non-principal non-anonymous boxes can’t be <a data-link-type="dfn" href="#blockify" id="ref-for-blockify⑨">blockified</a>:
blockification affects the element’s computed values
and thus determines the type of its <a data-link-type="dfn" href="#principal-box" id="ref-for-principal-box①②">principal box</a>.</p>
    <li data-md>
     <p>Boxes which <a data-link-type="dfn" href="#blockify" id="ref-for-blockify①⓪">blockify</a> their contents
can’t directly contain <a data-link-type="dfn" href="#inline-level" id="ref-for-inline-level⑦">inline-level</a> content;
any boxes or text sequences generated within such an element
must be <span id="ref-for-blockify①①">blockified</span> or wrapped in an <a data-link-type="dfn" href="#anonymous" id="ref-for-anonymous③">anonymous</a> <a data-link-type="dfn" href="#block-container" id="ref-for-block-container①⑥">block container</a>.</p>
    <li data-md>
     <p>Boxes which <a data-link-type="dfn" href="#inlinify" id="ref-for-inlinify⑧">inlinify</a> their contents
can’t directly contain <a data-link-type="dfn" href="#block-level" id="ref-for-block-level⑦">block-level</a> boxes;
any boxes generated within such an element
must be <a data-link-type="dfn" href="#inline-level" id="ref-for-inline-level⑧">inline-level</a>.</p>
    <li data-md>
     <p>Boxes that fundamentally cannot establish an <a data-link-type="dfn" href="#independent-formatting-context" id="ref-for-independent-formatting-context⑥">independent formatting context</a> (such as non-replaced inlines)
must not be asked to <a data-link-type="dfn" href="#establish-an-independent-formatting-context" id="ref-for-establish-an-independent-formatting-context⑤">establish an independent formatting context</a>.
Blockify them first,
or otherwise change their box type to one that can establish an <span id="ref-for-independent-formatting-context⑦">independent formatting context</span>.</p>
   </ul>
   
<!-- END VERBATIM SPEC: DO NOT EDIT ABOVE. -->


## Documentation and coding standards


- All public functions must include spec links with exact section anchors.
- Modules mirror spec chapters (`anonymous_blocks.rs`, `inline_formatting.rs`, etc.).
- Files kept under ~500 lines; imports at the top; avoid fully qualified paths (use imports/aliases).
- Mark non-production behavior `[MVP]`, `[Approximation]`, or `[Heuristic]` and link back here.
